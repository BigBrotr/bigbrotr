# ============================================================================
# Validator Service Configuration (BigBrotr)
# ============================================================================
# Description: Validate candidate relay URLs before adding to relays table
# Used by: src/services/validator.py
# Dependencies: Seeder and Finder write candidates to service_data
#
# Architecture: Stream (DB pages) -> Workers (per-network semaphores) -> Batch Collector
# Features:
#   - Pure asyncio (optimal for I/O-bound WebSocket validation)
#   - Per-network concurrency control (max_tasks per network)
#   - Network-aware timeouts (Tor/I2P need longer)
#   - Continuous checkpoints (crash-resilient)
# ============================================================================

# Cycle interval (seconds between validation runs)
interval: 300.0

# Network configuration with per-network concurrency control
# Each network type has: enabled, proxy_url, max_tasks, timeout
networks:
  clearnet:
    enabled: true
    max_tasks: 20              # Moderate concurrency to avoid rate limiting
    timeout: 15.0              # Slightly longer timeout for slower relays

  tor:
    enabled: true
    proxy_url: "socks5://tor:9050"
    max_tasks: 10              # Lower concurrency (Tor is slower)
    timeout: 30.0              # Longer timeout for Tor latency

  i2p:
    enabled: false             # Disabled by default (enable i2p service in docker-compose first)
    proxy_url: "socks5://i2p:4447"
    max_tasks: 5               # Even lower (I2P is slowest)
    timeout: 45.0              # Longest timeout for I2P

  loki:
    enabled: false             # Disabled by default (requires Lokinet - Linux only)
    proxy_url: "socks5://lokinet:1080"
    max_tasks: 5
    timeout: 30.0

# Batch sizes for DB operations
batch:
  fetch_size: 500              # Candidates to fetch from DB per page
  max_pending: 500             # Max tasks in memory (backpressure limit)
  write_size: 100              # Flush to DB every N validations (checkpoint)
  # max_candidates: null       # Uncomment to limit candidates per run

# Cleanup settings for failed candidates
cleanup:
  enabled: false               # Enable automatic cleanup of max-attempt candidates
  max_attempts: 10             # Delete candidates after this many failures
