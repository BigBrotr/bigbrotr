# ============================================================================
# Monitor Service Configuration (BigBrotr)
# ============================================================================
# Description: Monitor relay health and capabilities with full NIP-66 compliance
# Used by: src/services/monitor.py
# Dependencies: Validator must have validated relays first
# Environment: PRIVATE_KEY required if publishing enabled
# Notes: Uses overlay network proxies for hidden relay monitoring (.onion, .i2p, .loki)
# ============================================================================

# Cycle interval (seconds between monitoring runs)
# Range: >= 60.0
interval: 3600.0

# Prometheus metrics
metrics:
  enabled: true
  port: 8003
  host: "0.0.0.0"
  path: "/metrics"

# Unified network configuration
# Each network type has: enabled, proxy_url, max_tasks, timeout
networks:
  clearnet:
    enabled: true
    max_tasks: 50              # High concurrency for fast clearnet relays
    timeout: 30.0              # Timeout for relay checks

  tor:
    enabled: true
    proxy_url: "socks5://tor:9050"
    max_tasks: 10              # Lower concurrency (Tor is slower)
    timeout: 60.0              # Longer timeout for Tor latency

  i2p:
    enabled: false             # Disabled by default (enable i2p service in docker-compose first)
    proxy_url: "socks5://i2p:4447"
    max_tasks: 5               # Even lower (I2P is slowest)
    timeout: 90.0              # Longest timeout for I2P

  loki:
    enabled: false             # Disabled by default (requires Lokinet - Linux only)
    proxy_url: "socks5://lokinet:1080"
    max_tasks: 5
    timeout: 60.0

# Nostr keys for NIP-66 events
# Private key is loaded from PRIVATE_KEY environment variable
keys: {}

# Metadata to store in database
storing:
  nip11: true
  nip66_rtt: true
  nip66_ssl: true
  nip66_geo: true
  nip66_dns: true
  nip66_http: true

# Publishing configuration
publishing:
  # Kind 30166 relay discovery events
  discovery:
    enabled: true
    interval: 3600             # Minimum seconds since last check (Range: >= 0)
    include:                   # Which metadata to include in events
      nip11: true
      nip66_rtt: true
      nip66_ssl: true
      nip66_geo: true
      nip66_dns: true
      nip66_http: true
    monitored_relay: true      # Publish on the relay being checked
    configured_relays: false   # Publish to relays listed below
    relays: []

  # Kind 10166 monitor announcement
  announcement:
    enabled: true
    interval: 86400            # Rate limit (seconds)
    relays: []                 # Where to publish announcements

  # Kind 0 profile
  profile:
    enabled: false
    interval: 86400            # Rate limit (seconds)
    relays: []

# Geolocation configuration
# Requires MaxMind GeoLite2 databases (free with registration)
# Download from: https://dev.maxmind.com/geoip/geolocation-databases
# Place databases in static/ folder
geo:
  city_database_path: "static/GeoLite2-City.mmdb"
  asn_database_path: "static/GeoLite2-ASN.mmdb"
  update_frequency: "monthly"  # "monthly", "weekly", "none"

# Processing settings
processing:
  chunk_size: 100              # Relays to process per chunk (Range: 10 - 1000)
  # max_relays: 500            # Optional limit on relays per cycle
  nip11_max_size: 1048576      # Max NIP-11 response size (1MB default)
