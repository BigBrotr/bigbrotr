# ============================================================================
# Monitor Service Configuration (BigBrotr)
# ============================================================================
# Description: Monitor relay health and capabilities with full NIP-66 compliance
# Used by: src/services/monitor.py
# Dependencies: Validator must have validated relays first
# Environment: PRIVATE_KEY required if publishing enabled
# Notes: Uses overlay network proxies for hidden relay monitoring (.onion, .i2p, .loki)
# ============================================================================

# Cycle interval (seconds between monitoring runs)
# Range: >= 60.0
interval: 3600.0

# Prometheus metrics
metrics:
  enabled: true
  port: 8003
  host: "0.0.0.0"
  path: "/metrics"

# Unified network configuration
# Each network type has: enabled, proxy_url, max_tasks, timeout
networks:
  clearnet:
    enabled: true
    max_tasks: 50              # High concurrency for fast clearnet relays
    timeout: 30.0              # Timeout for relay checks

  tor:
    enabled: true
    proxy_url: "socks5://tor:9050"
    max_tasks: 10              # Lower concurrency (Tor is slower)
    timeout: 60.0              # Longer timeout for Tor latency

  i2p:
    enabled: false             # Disabled by default (enable i2p service in docker-compose first)
    proxy_url: "socks5://i2p:4447"
    max_tasks: 5               # Even lower (I2P is slowest)
    timeout: 90.0              # Longest timeout for I2P

  loki:
    enabled: false             # Disabled by default (requires Lokinet - Linux only)
    proxy_url: "socks5://lokinet:1080"
    max_tasks: 5
    timeout: 60.0

# Nostr keys for NIP-66 events
# Private key is loaded from PRIVATE_KEY environment variable
keys: {}

# Kind 30166 relay discovery events
# Publishes relay metadata to the Nostr network
discovery:
  enabled: true
  interval: 3600             # Seconds between re-checking a relay (Range: >= 60)
  include:                   # Which metadata to include in events (⊆ processing.compute)
    nip11: true              # NIP-11 relay information document
    nip66_rtt: true          # Round-trip time measurements
    nip66_ssl: true          # SSL certificate validation
    nip66_geo: true          # Geolocation (country, city, coordinates)
    nip66_dns: true          # DNS resolution time
    nip66_http: true         # HTTP response codes
  monitored_relay: true      # Publish to the relay being checked
  configured_relays: false   # Publish to relays listed below
  relays: []                 # Additional relays to publish to

# Kind 10166 monitor announcement
# Announces this monitor's existence and capabilities to the network
announcement:
  enabled: true
  interval: 86400            # Seconds between announcements (Range: >= 60)
  relays: []                 # Relays to publish announcements to

# Kind 0 profile
# Publishes monitor's profile metadata (name, about, picture)
profile:
  enabled: false
  interval: 86400            # Seconds between profile updates (Range: >= 60)
  relays: []                 # Relays to publish profile to

# Geolocation configuration
# Requires MaxMind GeoLite2 databases (free with registration)
# Download from: https://dev.maxmind.com/geoip/geolocation-databases
# Place databases in static/ folder
geo:
  city_database_path: "static/GeoLite2-City.mmdb"
  asn_database_path: "static/GeoLite2-ASN.mmdb"
  update_frequency: "monthly"  # "monthly", "weekly", "none"

# Processing settings
# Controls what metadata is computed and stored
# Dependency chain: compute → store → discovery.include
# (can only store what is computed, can only publish what is computed)
processing:
  chunk_size: 100              # Relays per batch (Range: 10 - 1000)
  # max_relays: 500            # Optional limit on total relays per cycle
  nip11_max_size: 1048576      # Max NIP-11 response size in bytes (1MB default)
  compute:                     # What metadata to compute
    nip11: true                # NIP-11 relay information document
    nip66_rtt: true            # Round-trip time (open/read/write latency)
    nip66_ssl: true            # SSL certificate chain validation
    nip66_geo: true            # IP geolocation (requires MaxMind databases)
    nip66_dns: true            # DNS resolution timing
    nip66_http: true           # HTTP status codes
  store:                       # What metadata to store in database (⊆ compute)
    nip11: true
    nip66_rtt: true
    nip66_ssl: true
    nip66_geo: true
    nip66_dns: true
    nip66_http: true
