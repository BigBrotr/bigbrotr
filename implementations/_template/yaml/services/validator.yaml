# ============================================================================
# BigBrotr Implementation Template - Validator Service Configuration
# ============================================================================
# Validates candidate relay URLs before promoting to relays table.
# Workflow: cleanup → fetch chunk → validate in parallel → persist → repeat
# Used by: src/services/validator.py
# Run mode: Continuous (runs every interval) or one-shot (--once flag)
# Dependencies: Seeder/Finder write candidates to service_data
# ============================================================================

# Cycle interval (seconds between validation runs)
# Range: >= 60.0
# Recommendation: 300-600 for production (5-10 minutes)
interval: 300.0

# Prometheus metrics and health checks
metrics:
  enabled: true
  port: 8002
  host: "0.0.0.0"
  path: "/metrics"
  health:
    max_cycle_age_seconds: 900.0   # Unhealthy if no cycle in 15 minutes

# Processing
processing:
  chunk_size: 100            # Candidates per chunk
  max_candidates: 500        # Limit per run (null = unlimited)

# Cleanup of exhausted candidates
cleanup:
  enabled: false             # Remove candidates with too many failures
  max_failures: 10           # Threshold for removal

# Network configuration (per-network concurrency and timeouts)
networks:
  clearnet:
    enabled: true
    max_tasks: 50            # High concurrency for fast clearnet relays
    timeout: 10.0            # Short timeout (clearnet is fast)

  tor:
    enabled: true
    proxy_url: "socks5://tor:9050"
    max_tasks: 10            # Lower concurrency (Tor is slower)
    timeout: 30.0            # Longer timeout for Tor latency

  i2p:
    enabled: false           # Requires I2P proxy
    proxy_url: "socks5://i2p:4447"
    max_tasks: 5             # Even lower (I2P is slowest)
    timeout: 45.0            # Longest timeout for I2P

  loki:
    enabled: false           # Requires Lokinet (Linux only)
    proxy_url: "socks5://lokinet:1080"
    max_tasks: 5
    timeout: 30.0

# ============================================================================
# CUSTOMIZATION NOTES
# ============================================================================
#
# NO TOR SUPPORT:
#   networks.tor.enabled: false
#   (Remove tor dependency from docker-compose.yaml)
#
# MINIMAL RESOURCES:
#   interval: 600.0
#   processing.max_candidates: 200
#   networks.clearnet.max_tasks: 20
#
# AGGRESSIVE VALIDATION:
#   interval: 120.0
#   processing.max_candidates: 1000
#   networks.clearnet.max_tasks: 100
#
# SLOW NETWORK:
#   networks.clearnet.timeout: 30.0
#
# ============================================================================
