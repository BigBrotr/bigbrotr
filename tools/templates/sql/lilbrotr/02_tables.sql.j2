{% extends "base/02_tables.sql.j2" %}
{% block events_table %}
-- ==========================================================================
-- event: Nostr event storage (lightweight)
-- ==========================================================================
-- Same columns as the full schema but tags, content, and sig are nullable
-- and always NULL (not populated by event_insert()), yielding ~60% disk
-- savings. Tagvalues is computed at insert time via tags_to_tagvalues().

CREATE TABLE IF NOT EXISTS event (
    id BYTEA PRIMARY KEY,
    pubkey BYTEA NOT NULL,
    created_at BIGINT NOT NULL,
    kind INTEGER NOT NULL,
    tags JSONB,
    tagvalues TEXT [] NOT NULL,
    content TEXT,
    sig BYTEA
);

COMMENT ON TABLE event IS 'Nostr events (tags/content/sig nullable, always NULL)';
COMMENT ON COLUMN event.id IS 'SHA-256 event hash (32 bytes, stored as bytea from hex)';
COMMENT ON COLUMN event.pubkey IS 'Author public key (32 bytes, stored as bytea from hex)';
COMMENT ON COLUMN event.created_at IS 'Unix timestamp of event creation';
COMMENT ON COLUMN event.kind IS 'Event kind per NIP-01 (0=metadata, 1=text note, 3=contacts, etc.)';
COMMENT ON COLUMN event.tags IS 'JSONB tag array (nullable, always NULL)';
COMMENT ON COLUMN event.tagvalues IS 'Single-char tag values computed at insert time by event_insert() for GIN indexing';
COMMENT ON COLUMN event.content IS 'Event content (nullable, always NULL)';
COMMENT ON COLUMN event.sig IS 'Schnorr signature (nullable, always NULL)';
{% endblock %}
