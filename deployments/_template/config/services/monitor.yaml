# =============================================================================
# Monitor Service Configuration Template (All Default Values)
# =============================================================================
# Performs health checks on validated relays:
#   1. WebSocket connectivity test (open)
#   2. Subscription capability test (read)
#   3. Event publication test (write, requires PRIVATE_KEY)
#   4. NIP-11 relay information document fetch
#   5. SSL/TLS certificate validation
#   6. DNS resolution timing
#   7. IP geolocation lookup
#   8. Results stored as NIP-66 metadata
#
# Run mode: Continuous (runs every interval)
# Dependencies: Validator must have validated relays first
# Configuration class: src/services/monitor.py::MonitorConfig
#
# Environment variables:
#   PRIVATE_KEY: Required for write tests and NIP-66 event publishing.
# =============================================================================

# -----------------------------------------------------------------------------
# Base Service Settings (inherited from BaseServiceConfig)
# -----------------------------------------------------------------------------
# Class: src/core/base_service.py::BaseServiceConfig

# Seconds between monitoring cycles
# Lower values = more frequent monitoring, higher resource usage
# Recommendation: 3600-7200 for production
# Range: >= 60.0
# Default: 300.0
interval: 300.0

# Stop service after this many consecutive cycle failures
# Set to 0 for unlimited retries
# Range: >= 0
# Default: 5
max_consecutive_failures: 5

# -----------------------------------------------------------------------------
# Prometheus Metrics Configuration
# -----------------------------------------------------------------------------
# Class: src/core/metrics.py::MetricsConfig

metrics:
  # Enable or disable metrics collection and HTTP server
  # Default: false
  enabled: false

  # TCP port for the metrics HTTP server
  # In Docker, all services can use the same port (different containers)
  # Range: 1024-65535
  # Default: 8000
  port: 8000

  # IP address to bind the metrics server to
  # Use "0.0.0.0" for Docker/container environments
  # Default: "127.0.0.1"
  host: "127.0.0.1"

  # URL path for the metrics endpoint
  # Default: "/metrics"
  path: "/metrics"

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
# Per-network settings for relay monitoring.
# Class: src/services/common/configs.py::NetworkConfig

networks:
  # Clearnet (standard internet relays)
  clearnet:
    enabled: true
    proxy_url: null
    max_tasks: 50
    timeout: 10.0

  # Tor (.onion relays) - requires Tor proxy
  tor:
    enabled: false
    proxy_url: "socks5://tor:9050"
    max_tasks: 10
    timeout: 30.0

  # I2P (.i2p relays) - requires I2P router
  i2p:
    enabled: false
    proxy_url: "socks5://i2p:4447"
    max_tasks: 5
    timeout: 45.0

  # Lokinet (.loki relays) - requires Lokinet (Linux only)
  loki:
    enabled: false
    proxy_url: "socks5://lokinet:1080"
    max_tasks: 5
    timeout: 30.0

# -----------------------------------------------------------------------------
# Nostr Keys Configuration
# -----------------------------------------------------------------------------
# Keys are loaded from PRIVATE_KEY environment variable automatically.
# Required for: write tests, NIP-66 publishing (discovery, announcement, profile)
# Class: src/utils/keys.py::KeysConfig
#
# NEVER store private keys in configuration files.
# Set via: export PRIVATE_KEY="nsec1..." or hex format

keys: {}

# -----------------------------------------------------------------------------
# Publishing Configuration
# -----------------------------------------------------------------------------
# Default relay list for publishing NIP-66 events.
# Class: src/services/monitor.py::PublishingConfig

publishing:
  # Default relay list for publishing events
  # Used by discovery, announcement, and profile if their relays list is empty
  # Default: [] (empty, publishing disabled unless relays specified)
  relays: []
    # Example:
    # - wss://relay.damus.io
    # - wss://nos.lol
    # - wss://relay.nostr.band

# -----------------------------------------------------------------------------
# Discovery Configuration (Kind 30166)
# -----------------------------------------------------------------------------
# Publishes relay metadata to the Nostr network as NIP-66 events.
# Class: src/services/monitor.py::DiscoveryConfig

discovery:
  # Enable or disable NIP-66 relay discovery publishing
  # Default: true
  enabled: true

  # Seconds between re-publishing for each relay
  # Range: >= 60
  # Default: 3600 (1 hour)
  interval: 3600

  # Which metadata types to include in published events
  # Must be a subset of processing.compute
  include:
    nip11_info: true
    nip66_rtt: true
    nip66_ssl: true
    nip66_geo: true
    nip66_net: true
    nip66_dns: true
    nip66_http: true

  # Override publishing.relays for discovery events
  # Empty = use publishing.relays
  # Default: []
  relays: []

# -----------------------------------------------------------------------------
# Announcement Configuration (Kind 10166)
# -----------------------------------------------------------------------------
# Announces this monitor's existence and capabilities to the network.
# Class: src/services/monitor.py::AnnouncementConfig

announcement:
  # Enable or disable monitor announcement publishing
  # Default: true
  enabled: true

  # Seconds between announcements
  # Range: >= 60
  # Default: 86400 (24 hours)
  interval: 86400

  # Override publishing.relays for announcement events
  # Empty = use publishing.relays
  # Default: []
  relays: []

# -----------------------------------------------------------------------------
# Profile Configuration (Kind 0)
# -----------------------------------------------------------------------------
# Publishes monitor's profile metadata (NIP-01).
# Class: src/services/monitor.py::ProfileConfig

profile:
  # Enable or disable profile publishing
  # Default: false
  enabled: false

  # Seconds between profile updates
  # Range: >= 60
  # Default: 86400 (24 hours)
  interval: 86400

  # Override publishing.relays for profile events
  # Empty = use publishing.relays
  # Default: []
  relays: []

  # Profile metadata (all optional, default: null)
  # name: "My Monitor"
  # about: "NIP-66 relay monitor"
  # picture: "https://example.com/avatar.png"
  # nip05: "monitor@example.com"
  # website: "https://example.com"
  # banner: "https://example.com/banner.png"
  # lud16: "monitor@getalby.com"

# -----------------------------------------------------------------------------
# Geolocation Configuration
# -----------------------------------------------------------------------------
# MaxMind GeoLite2 databases for IP geolocation.
# Databases are auto-downloaded from GitHub mirror if missing.
# Class: src/services/monitor.py::GeoConfig

geo:
  # Path to MaxMind GeoLite2 City database
  # Default: "static/GeoLite2-City.mmdb"
  city_database_path: "static/GeoLite2-City.mmdb"

  # Path to MaxMind GeoLite2 ASN database
  # Default: "static/GeoLite2-ASN.mmdb"
  asn_database_path: "static/GeoLite2-ASN.mmdb"

  # Download URL for City database (auto-download if missing)
  # Default: GitHub P3TERX mirror
  city_download_url: "https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-City.mmdb"

  # Download URL for ASN database (auto-download if missing)
  # Default: GitHub P3TERX mirror
  asn_download_url: "https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-ASN.mmdb"

  # Maximum age of databases before re-download (days)
  # null = never update (manual updates only)
  # Default: 30
  max_age_days: 30

  # Maximum download size per database file in bytes (safety limit)
  # Prevents memory exhaustion from corrupted or unexpected responses
  # Range: 1000000-500000000 (1 MB - 500 MB)
  # Default: 100000000 (100 MB)
  max_download_size: 100000000

  # Geohash precision for location encoding
  # Higher values = more precise location (9 = ~4.77m)
  # Range: 1-12
  # Default: 9
  geohash_precision: 9

# -----------------------------------------------------------------------------
# Processing Configuration
# -----------------------------------------------------------------------------
# Controls what metadata is computed, stored, and published.
# Dependency chain: compute -> store -> discovery.include
# Class: src/services/monitor.py::ProcessingConfig

processing:
  # Relays to process per database batch
  # Higher values = fewer round-trips, more memory
  # Range: 10-1000
  # Default: 100
  chunk_size: 100

  # Maximum relays to process per cycle
  # null = unlimited (process all relays)
  # Default: null
  max_relays: null

  # Maximum NIP-11 info response size in bytes
  # Prevents memory exhaustion from malformed responses
  # Default: 1048576 (1 MB)
  nip11_info_max_size: 1048576

  # Which metadata types to compute
  # Processing time increases with more types enabled
  compute:
    nip11_info: true     # NIP-11 relay information document
    nip66_rtt: true       # Round-trip time (open/read/write latency)
    nip66_ssl: true       # SSL certificate chain validation
    nip66_geo: true       # IP geolocation (requires MaxMind City database)
    nip66_net: true       # Network/ASN info (requires MaxMind ASN database)
    nip66_dns: true       # DNS resolution timing
    nip66_http: true      # HTTP status codes

  # Which metadata types to store in database
  # Must be a subset of compute
  store:
    nip11_info: true
    nip66_rtt: true
    nip66_ssl: true
    nip66_geo: true
    nip66_net: true
    nip66_dns: true
    nip66_http: true

# =============================================================================
# CUSTOMIZATION GUIDE
# =============================================================================
#
# NO GEOLOCATION (skip IP lookup):
#   processing.compute.nip66_geo: false
#   processing.compute.nip66_net: false
#   processing.store.nip66_geo: false
#   processing.store.nip66_net: false
#   discovery.include.nip66_geo: false
#   discovery.include.nip66_net: false
#
# NO WRITE TESTS (no PRIVATE_KEY needed):
#   processing.compute.nip66_rtt: false
#
# DATABASE ONLY (no Nostr publishing):
#   discovery.enabled: false
#   announcement.enabled: false
#   profile.enabled: false
#
# MINIMAL RESOURCES:
#   interval: 7200.0
#   networks.clearnet.max_tasks: 10
#   processing.chunk_size: 20
#   processing.compute:
#     nip11_info: true
#     nip66_rtt: false
#     nip66_ssl: false
#     nip66_geo: false
#     nip66_net: false
#     nip66_dns: false
#     nip66_http: false
#
# ENABLE TOR MONITORING:
#   networks.tor.enabled: true
#   (requires Tor proxy service)
#
# CUSTOM METRICS PORT:
#   metrics.port: 8003
#
# =============================================================================
